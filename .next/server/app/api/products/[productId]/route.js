"use strict";(()=>{var e={};e.id=19,e.ids=[19],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},77282:e=>{e.exports=require("process")},71267:e=>{e.exports=require("worker_threads")},99561:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>S,originalPathname:()=>I,patchFetch:()=>Z,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>q});var o={};r.r(o),r.d(o,{DELETE:()=>m,GET:()=>l,POST:()=>g,dynamic:()=>y});var n=r(95419),s=r(69108),a=r(99678),i=r(25150),d=r(4385),u=r(18237),c=r(93183),p=r(78070);let l=async(e,{params:t})=>{try{await (0,u.P)();let e=await d.Z.findById(t.productId).populate({path:"collections",model:i.Z});if(!e)return new p.Z(JSON.stringify({message:"Product not found"}),{status:404});return new p.Z(JSON.stringify(e),{status:200,headers:{"Access-Control-Allow-Origin":`${process.env.ECOMMERCE_STORE_URL}`,"Access-Control-Allow-Methods":"GET","Access-Control-Allow-Headers":"Content-Type"}})}catch(e){return console.log("[productId_GET]",e),new p.Z("Internal error",{status:500})}},g=async(e,{params:t})=>{try{let{userId:r}=(0,c.I8)();if(!r)return new p.Z("Unauthorized",{status:401});await (0,u.P)();let o=await d.Z.findById(t.productId);if(!o)return new p.Z(JSON.stringify({message:"Product not found"}),{status:404});let{title:n,description:s,media:a,category:l,collections:g,tags:m,sizes:y,colors:f,price:w,expense:x}=await e.json();if(!n||!s||!a||!l||!w||!x)return new p.Z("Not enough data to create a new product",{status:400});let h=g.filter(e=>!o.collections.includes(e)),S=o.collections.filter(e=>!g.includes(e));await Promise.all([...h.map(e=>i.Z.findByIdAndUpdate(e,{$push:{products:o._id}})),...S.map(e=>i.Z.findByIdAndUpdate(e,{$pull:{products:o._id}}))]);let q=await d.Z.findByIdAndUpdate(o._id,{title:n,description:s,media:a,category:l,collections:g,tags:m,sizes:y,colors:f,price:w,expense:x},{new:!0}).populate({path:"collections",model:i.Z});return await q.save(),p.Z.json(q,{status:200})}catch(e){return console.log("[productId_POST]",e),new p.Z("Internal error",{status:500})}},m=async(e,{params:t})=>{try{let{userId:e}=(0,c.I8)();if(!e)return new p.Z("Unauthorized",{status:401});await (0,u.P)();let r=await d.Z.findById(t.productId);if(!r)return new p.Z(JSON.stringify({message:"Product not found"}),{status:404});return await d.Z.findByIdAndDelete(r._id),await Promise.all(r.collections.map(e=>i.Z.findByIdAndUpdate(e,{$pull:{products:r._id}}))),new p.Z(JSON.stringify({message:"Product deleted"}),{status:200})}catch(e){return console.log("[productId_DELETE]",e),new p.Z("Internal error",{status:500})}},y="force-dynamic",f=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/[productId]/route",pathname:"/api/products/[productId]",filename:"route",bundlePath:"app/api/products/[productId]/route"},resolvedPagePath:"C:\\Users\\ASharma\\Documents\\New folder\\borcella_admin-master\\app\\api\\products\\[productId]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:w,staticGenerationAsyncStorage:x,serverHooks:h,headerHooks:S,staticGenerationBailout:q}=f,I="/api/products/[productId]/route";function Z(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},25150:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(11185),n=r.n(o);let s=new(n()).Schema({title:{type:String,required:!0,unique:!0},description:String,image:{type:String,required:!0},products:[{type:n().Schema.Types.ObjectId,ref:"Product"}],createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),a=n().models.Collection||n().model("Collection",s)},4385:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(11185),n=r.n(o);let s=new(n()).Schema({title:String,description:String,media:[String],category:String,collections:[{type:n().Schema.Types.ObjectId,ref:"Collection"}],tags:[String],sizes:[String],colors:[String],price:{type:n().Schema.Types.Decimal128,get:e=>parseFloat(e.toString())},expense:{type:n().Schema.Types.Decimal128,get:e=>parseFloat(e.toString())},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{toJSON:{getters:!0}}),a=n().models.Product||n().model("Product",s)},18237:(e,t,r)=>{r.d(t,{P:()=>a});var o=r(11185),n=r.n(o);let s=!1,a=async()=>{if(n().set("strictQuery",!0),s){console.log("MongoDB is already connected");return}try{await n().connect(process.env.MONGODB_URL||"",{dbName:"Borcelle_Admin"}),s=!0,console.log("MongoDB is connected")}catch(e){console.log(e)}}},95419:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,70,183],()=>r(99561));module.exports=o})();